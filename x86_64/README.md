# `x86_64` static build

The `x86_64` crystal build is built inside an alpine linux container as a
statically linked binary using musl libc. `libgc` is built on debian
to make it work on glibc. `deb`s and `rpm`s are created using the `fpm` tool.
The whole process is automated using a `Makefile`.

The required libraries to build crystal are generated by `make deps` and are left in `builds/deps`.
This includes locally built apk libraries, libgc, libevent for debian and alpine packages. The `build/deps` directory should look as:

```
.
└── deps
    ├── alpine
    │   ├── community
    │   │   └── x86_64
    │   │       ├── APKINDEX.tar.gz
    │   │       ├── llvm4-4.0.0-r6.apk
    │   │       ├── llvm4-dev-4.0.0-r6.apk
    │   │       ├── llvm4-libs-4.0.0-r6.apk
    │   │       ├── llvm4-static-4.0.0-r6.apk
    │   │       └── llvm4-test-utils-4.0.0-r6.apk
    │   ├── libs
    │   │   ├── libcord.a
    │   │   ├── libevent.a
    │   │   ├── libevent_core.a
    │   │   ├── libevent_extra.a
    │   │   ├── libevent_pthreads.a
    │   │   └── libgc.a
    │   └── main
    │       └── x86_64
    │           ├── APKINDEX.tar.gz
    │           ├── libffi-3.2.1-r4.apk
    │           ├── libffi-dev-3.2.1-r4.apk
    │           ├── libffi-doc-3.2.1-r4.apk
    │           ├── libpcre16-8.41-r1.apk
    │           ├── libpcre32-8.41-r1.apk
    │           ├── libpcrecpp-8.41-r1.apk
    │           ├── pcre-8.41-r1.apk
    │           ├── pcre-dev-8.41-r1.apk
    │           ├── pcre-doc-8.41-r1.apk
    │           ├── pcre-tools-8.41-r1.apk
    │           ├── yaml-0.1.7-r0.apk
    │           ├── yaml-dev-0.1.7-r0.apk
    │           ├── zlib-1.2.11-r1.apk
    │           ├── zlib-dev-1.2.11-r1.apk
    │           └── zlib-doc-1.2.11-r1.apk
    └── debian
        ├── libcord.a
        ├── libevent.a
        ├── libevent_core.a
        ├── libevent_extra.a
        ├── libevent_pthreads.a
        └── libgc.a
```

In `files/abuild` a private key should be placed before building the dependencies. Otherwise they can be download from https://s3.amazonaws.com/dist.crystal-lang.org/deps/crystal-deps-v20171221-r1.tar.gz .

# Dependencies

- `docker`
- [`fpm`](https://github.com/jordansissel/fpm)
- `rpmbuild` (available from the `rpm-org` AUR package)

# Getting started

Just run `make help`!
